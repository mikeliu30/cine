# 动态画幅比例功能测试指南

## 测试目标
验证卡片节点能够根据图片的实际比例（aspectRatio）动态调整显示尺寸。

## 测试环境
- 浏览器：Chrome/Edge/Firefox
- 开发服务器：`npm run dev`
- 测试页面：http://localhost:3000/canvas

## 测试用例

### 测试用例 1：16:9 横屏图片
**步骤：**
1. 打开画布页面
2. 点击右侧生成面板
3. 选择画幅比例：16:9
4. 输入提示词：`A beautiful landscape with mountains`
5. 点击生成

**预期结果：**
- 卡片宽度：约 683px
- 卡片高度：384px
- 图片完整显示，无裁剪
- 卡片呈横向矩形

### 测试用例 2：9:16 竖屏图片
**步骤：**
1. 选择画幅比例：9:16
2. 输入提示词：`A portrait of a person`
3. 点击生成

**预期结果：**
- 卡片宽度：约 216px
- 卡片高度：384px
- 图片完整显示，无裁剪
- 卡片呈竖向矩形

### 测试用例 3：1:1 方形图片
**步骤：**
1. 选择画幅比例：1:1
2. 输入提示词：`A cute cat`
3. 点击生成

**预期结果：**
- 卡片宽度：384px
- 卡片高度：384px
- 图片完整显示，无裁剪
- 卡片呈正方形

### 测试用例 4：4:3 标准图片
**步骤：**
1. 选择画幅比例：4:3
2. 输入提示词：`A classic photograph`
3. 点击生成

**预期结果：**
- 卡片宽度：约 512px
- 卡片高度：384px
- 图片完整显示，无裁剪
- 卡片呈横向矩形（比16:9窄）

### 测试用例 5：混合比例画布
**步骤：**
1. 在同一画布上生成多个不同比例的图片
2. 观察卡片排列

**预期结果：**
- 不同比例的卡片尺寸不同
- 所有卡片高度一致（384px）
- 宽度根据比例变化
- 连接线正确连接到卡片边缘

### 测试用例 6：向后兼容性
**步骤：**
1. 打开包含旧节点的画布（没有 aspectRatio 字段）
2. 观察旧节点显示

**预期结果：**
- 旧节点使用默认比例 9:16
- 卡片正常显示，无错误
- 功能正常工作

### 测试用例 7：快速生成
**步骤：**
1. 右键点击画布空白处
2. 选择"快速生成图片"

**预期结果：**
- 生成的卡片使用默认比例 16:9
- 卡片宽度约 683px
- 卡片高度 384px

## 验证方法

### 方法 1：浏览器开发者工具
1. 右键点击卡片 → 检查元素
2. 查看 `<div>` 的 `style` 属性
3. 验证 `width` 和 `height` 值

### 方法 2：控制台日志
在 `CardNode.tsx` 中添加日志：
```typescript
console.log('[CardNode] Dimensions:', cardDimensions, 'AspectRatio:', data.aspectRatio);
```

### 方法 3：视觉检查
- 横屏图片应该明显比竖屏图片宽
- 方形图片应该是正方形
- 图片不应该被裁剪或变形

## 常见问题排查

### 问题 1：所有卡片尺寸相同
**原因：** aspectRatio 没有正确保存到节点数据
**解决：** 检查 `canvas/page.tsx` 中的 `handleGenerate` 函数

### 问题 2：卡片尺寸异常
**原因：** aspectRatio 格式错误或解析失败
**解决：** 检查 `getCardDimensions()` 函数的解析逻辑

### 问题 3：图片被裁剪
**原因：** 使用了 `object-cover` 而不是 `object-contain`
**解决：** 确认图片 CSS 类为 `object-contain`

### 问题 4：连接线位置错误
**原因：** 卡片尺寸变化后，连接点位置需要调整
**解决：** 检查 Handle 组件的位置设置

## 性能测试

### 测试场景：大量节点
1. 创建 50+ 个不同比例的卡片
2. 观察渲染性能
3. 检查是否有卡顿

**预期结果：**
- 渲染流畅，无明显卡顿
- 内存占用正常
- 缩放和拖拽响应及时

## 回归测试

确保以下功能仍然正常工作：
- ✅ 节点拖拽
- ✅ 节点连接
- ✅ 节点删除
- ✅ 右键菜单
- ✅ 全屏预览
- ✅ 详情弹窗
- ✅ 协作功能
- ✅ 撤销/重做

## 测试报告模板

```markdown
## 测试日期：YYYY-MM-DD
## 测试人员：[姓名]

### 测试结果
- [ ] 测试用例 1：16:9 横屏 - 通过/失败
- [ ] 测试用例 2：9:16 竖屏 - 通过/失败
- [ ] 测试用例 3：1:1 方形 - 通过/失败
- [ ] 测试用例 4：4:3 标准 - 通过/失败
- [ ] 测试用例 5：混合比例 - 通过/失败
- [ ] 测试用例 6：向后兼容 - 通过/失败
- [ ] 测试用例 7：快速生成 - 通过/失败

### 发现的问题
1. [问题描述]
2. [问题描述]

### 建议
1. [改进建议]
2. [改进建议]
```

