# ğŸ“‹ Tapnow é£æ ¼æ— é™ AIGC ç”»å¸ƒ - éœ€æ±‚æ‹†è§£

## ğŸ“Š å½“å‰å®ç° vs PRD å·®è·åˆ†æ

### ä¸€ã€ç”»å¸ƒäº¤äº’å±‚ (The Canvas)

| åŠŸèƒ½ | PRD è¦æ±‚ | å½“å‰çŠ¶æ€ | ä¼˜å…ˆçº§ |
|------|----------|----------|--------|
| æ— é™ç¼©æ”¾ (Zoom) | é¼ æ ‡æ»šè½®ç¼©æ”¾ | âœ… å·²å®ç° | - |
| ç”»å¸ƒæ¼«æ¸¸ (Pan) | ç©ºæ ¼/ä¸­é”®æ‹–æ‹½ | âœ… å·²å®ç° | - |
| é¹°çœ¼è§†å›¾ (Minimap) | ç¼©ç•¥å›¾å¯¼èˆª | âœ… å·²å®ç° | - |
| èŠ‚ç‚¹è¿çº¿ | è´å¡å°”æ›²çº¿ï¼Œå®¶æ—æ ‘ | âœ… å·²å®ç° | - |
| å¤šäººåä½œ | Yjs CRDT åŒæ­¥ | âœ… å·²å®ç° | - |
| å¤šäººå…‰æ ‡ | å®æ—¶å…‰æ ‡åŒæ­¥ | âœ… å·²å®ç° | - |
| **å³é”®èœå•** | ä¸Šä¼ /æ·»åŠ èµ„äº§/æ·»åŠ èŠ‚ç‚¹/æ’¤é”€é‡åš | âŒ æœªå®ç° | ğŸ”´ P1 |
| **å¿«æ·é”®** | Cmd+Z/Shift+Cmd+Z/Cmd+V | âŒ æœªå®ç° | ğŸŸ¡ P2 |

---

### äºŒã€èŠ‚ç‚¹èµ„äº§å±‚ (Nodes)

| èŠ‚ç‚¹ç±»å‹ | PRD è¦æ±‚ | å½“å‰çŠ¶æ€ | ä¼˜å…ˆçº§ |
|----------|----------|----------|--------|
| **Image Node** | é™æ€å›¾ç‰‡ï¼Œé¢„è§ˆ/ä¸‹è½½ | âœ… CardNode å·²å®ç° | - |
| **Video Node** | åŠ¨æ€è§†é¢‘ï¼Œæ‚¬åœæ’­æ”¾ | âŒ æœªå®ç° | ğŸ”´ P1 |
| **Text Node** | çº¯æ–‡æœ¬æç¤ºè¯ | âŒ æœªå®ç° | ğŸŸ¡ P2 |

#### èŠ‚ç‚¹çŠ¶æ€æ˜¾ç¤º

| åŠŸèƒ½ | è¯´æ˜ | å½“å‰çŠ¶æ€ | ä¼˜å…ˆçº§ |
|------|------|----------|--------|
| **idle çŠ¶æ€** | å¾…ç”Ÿæˆ | âœ… å·²å®ç° | - |
| **generating çŠ¶æ€** | ç”Ÿæˆä¸­ + å‘¼å¸ç¯ | âœ… å·²å®ç° | - |
| **è¿›åº¦æ¡** | æ˜¾ç¤ºç”Ÿæˆè¿›åº¦ | âœ… å·²å®ç° | - |
| **success çŠ¶æ€** | å®Œæˆ | âœ… å·²å®ç° | - |
| **error çŠ¶æ€** | å¤±è´¥ | âœ… å·²å®ç° | - |

#### èŠ‚ç‚¹æ‚¬åœèœå• (Floating Action Bar)

| åŠŸèƒ½ | è¯´æ˜ | å½“å‰çŠ¶æ€ | ä¼˜å…ˆçº§ |
|------|------|----------|--------|
| **ç¼–è¾‘/é‡ç»˜** | è¿›å…¥ç¼–è¾‘æ¨¡å¼ | âŒ æœªå®ç° | ğŸ”´ P1 |
| **å¤åˆ¶** | å¤åˆ¶èŠ‚ç‚¹å‚æ•° | âŒ æœªå®ç° | ğŸŸ¡ P2 |
| **ä¸‹è½½** | ä¿å­˜æœ¬åœ° | âŒ æœªå®ç° | ğŸŸ¡ P2 |
| **åˆ é™¤** | ç§»é™¤èŠ‚ç‚¹åŠå…³è”çº¿ | âŒ æœªå®ç° | ğŸ”´ P1 |
| **æŸ¥çœ‹è¯¦æƒ…** | æŸ¥çœ‹ Prompt å’Œå‚æ•° | âŒ æœªå®ç° | ğŸŸ¡ P2 |
| **å…¨å±é¢„è§ˆ** | å¤§å›¾æŸ¥çœ‹ | âŒ æœªå®ç° | ğŸŸ¢ P3 |

---

### ä¸‰ã€ç”Ÿæˆæ§åˆ¶å±‚ (Generation Panel) - æ ¸å¿ƒå¼¹çª—

| åŠŸèƒ½æ¨¡å— | PRD è¦æ±‚ | å½“å‰çŠ¶æ€ | ä¼˜å…ˆçº§ |
|----------|----------|----------|--------|
| **åŒå‡»å”¤èµ·å¼¹çª—** | ç‚¹å‡»èŠ‚ç‚¹æ‰“å¼€ç”Ÿæˆå™¨ | âœ… å·²å®ç° | - |
| **Prompt è¾“å…¥æ¡†** | è‡ªç„¶è¯­è¨€è¾“å…¥ | âœ… å·²å®ç° | - |
| **æ¨¡å‹é€‰æ‹©å™¨** | Banana Pro/å³æ¢¦4.5 | âœ… å·²å®ç° (UI) | - |
| **ç”»å¹…æ¯”ä¾‹** | 16:9/9:16/1:1/4:3 | âœ… å·²å®ç° | - |
| **ç”ŸæˆæŒ‰é’®** | è§¦å‘ç”Ÿæˆ | âœ… å·²å®ç° | - |
| **èŠ‚ç‚¹çŠ¶æ€æ›´æ–°** | idleâ†’generatingâ†’success | âœ… å·²å®ç° | - |
| **Mock é€‚é…å™¨** | 3ç§’æ¨¡æ‹Ÿç”Ÿæˆ | âœ… å·²å®ç° | - |
| **é­”æ³•æ£’å¢å¼º** | GPT æ‰©å†™ä¼˜åŒ– Prompt | âŒ æœªå®ç° | ï¿½ P2 |
| **å‚è€ƒå›¾æ’æ§½** | æ˜¾ç¤ºçˆ¶èŠ‚ç‚¹ç¼©ç•¥å›¾ | âŒ æœªå®ç° | ğŸ”´ P1 |
| **åˆ†è¾¨ç‡** | 1K/2K/4K | âŒ æœªå®ç° | ğŸŸ¡ P2 |
| **æ‰¹æ¬¡æ•°é‡** | 1-14 å¼  | âŒ æœªå®ç° | ğŸŸ¡ P2 |
| **é«˜çº§è®¾ç½®æŠ˜å ** | Seed/Steps/CFG | âŒ æœªå®ç° | ğŸŸ¡ P2 |

---

### å››ã€è™šæ‹Ÿæ‘„å½±æœº (Virtual Camera) - å›¾ç‰‡ç”Ÿæˆ

| å‚æ•° | é€‰é¡¹ | å½“å‰çŠ¶æ€ | ä¼˜å…ˆçº§ |
|------|------|----------|--------|
| **æœºå‹æ¨¡æ‹Ÿ** | Digital/Sony Venice/Film | âŒ æœªå®ç° | ğŸŸ¢ P3 |
| **é•œå¤´ç»„** | Zeiss Ultra Prime/Canon EF | âŒ æœªå®ç° | ğŸŸ¢ P3 |
| **ç„¦è·** | 14mm/24mm/35mm/50mm/85mm | âŒ æœªå®ç° | ğŸŸ¢ P3 |
| **å…‰åœˆ** | f/1.4/f/2.8/f/4/f/8 | âŒ æœªå®ç° | ğŸŸ¢ P3 |

---

### äº”ã€è¿é•œæŒ‡ä»¤çŸ©é˜µ (Camera Movement) - è§†é¢‘ç”Ÿæˆ

| ç±»å‹ | æŒ‡ä»¤ | å½“å‰çŠ¶æ€ | ä¼˜å…ˆçº§ |
|------|------|----------|--------|
| **æ¨æ‹‰ç±»** | Zoom In/Zoom Out | âŒ æœªå®ç° | ğŸ”´ P1 |
| **æ‘‡æ‘„ç±»** | Pan Left/Right, Tilt Up/Down | âŒ æœªå®ç° | ğŸ”´ P1 |
| **ç§»æ‘„ç±»** | Truck/Pedestal/Dolly | âŒ æœªå®ç° | ğŸ”´ P1 |
| **ç‰¹æ®Šç±»** | Follow/Shake/Static | âŒ æœªå®ç° | ğŸŸ¡ P2 |

---

### å…­ã€API æ¥å…¥

#### å›¾ç‰‡ç”Ÿæˆ (ä¸€æœŸ)

| æ¨¡å‹ | çŠ¶æ€ | ä¼˜å…ˆçº§ |
|------|------|--------|
| **Banana Pro** | âŒ æœªæ¥å…¥ | ğŸ”´ P0 |
| **å³æ¢¦ 4.5** | âŒ æœªæ¥å…¥ | ğŸ”´ P0 |

#### è§†é¢‘ç”Ÿæˆ (ä¸€æœŸ)

| æ¨¡å‹ | çŠ¶æ€ | ä¼˜å…ˆçº§ |
|------|------|--------|
| **Hailuo 2.3** | âŒ æœªæ¥å…¥ | ğŸ”´ P1 |
| **Kling 2.0** | âŒ æœªæ¥å…¥ | ğŸŸ¡ P2 |
| **Vidu 2.0** | âŒ æœªæ¥å…¥ | ğŸŸ¡ P2 |

---

## ğŸ¯ å¼€å‘ä»»åŠ¡æ‹†è§£

### âœ… MVP å·²å®Œæˆ (Phase 0)

```
[x] 0.1 ç”»å¸ƒåŸºç¡€
    [x] æ— é™ç¼©æ”¾ (Zoom)
    [x] ç”»å¸ƒæ¼«æ¸¸ (Pan)
    [x] é¹°çœ¼è§†å›¾ (Minimap)
    [x] èŠ‚ç‚¹è¿çº¿
    [x] å¤šäººåä½œ (Yjs)
    [x] å¤šäººå…‰æ ‡åŒæ­¥

[x] 0.2 èŠ‚ç‚¹ç³»ç»Ÿ
    [x] CardNode ç»„ä»¶
    [x] èŠ‚ç‚¹çŠ¶æ€æ˜¾ç¤º (idle/generating/success/error)
    [x] ç”Ÿæˆä¸­å‘¼å¸ç¯åŠ¨ç”»
    [x] ç”Ÿæˆè¿›åº¦æ¡

[x] 0.3 ç”Ÿæˆæ§åˆ¶ MVP
    [x] åŒå‡»èŠ‚ç‚¹å”¤èµ·å¼¹çª—
    [x] Prompt è¾“å…¥æ¡†
    [x] æ¨¡å‹é€‰æ‹©å™¨ (UI)
    [x] ç”»å¹…æ¯”ä¾‹é€‰æ‹©
    [x] ç”ŸæˆæŒ‰é’®
    [x] Mock é€‚é…å™¨ (3ç§’æ¨¡æ‹Ÿ)
    [x] ç”ŸæˆçŠ¶æ€ç®¡ç† (Zustand)
    [x] èŠ‚ç‚¹çŠ¶æ€è‡ªåŠ¨æ›´æ–°
```

### ğŸ”´ Phase 1: çœŸå® API æ¥å…¥ (P0) - é¢„è®¡ 1-2 å¤©

```
[ ] 1.1 API é€‚é…å™¨
    [ ] Banana Pro é€‚é…å™¨
    [ ] å³æ¢¦ 4.5 é€‚é…å™¨
    [ ] ç»Ÿä¸€æ¥å£å°è£…
    [ ] é”™è¯¯å¤„ç†

[ ] 1.2 ç¯å¢ƒé…ç½®
    [ ] .env.local é…ç½®
    [ ] API Key ç®¡ç†
```

### ğŸ”´ Phase 2: èŠ‚ç‚¹ç³»ç»Ÿå®Œå–„ (P1) - é¢„è®¡ 2-3 å¤©

```
[ ] 2.1 èŠ‚ç‚¹æ‚¬åœèœå• (FloatingActionBar)
    [ ] ç¼–è¾‘/é‡ç»˜æŒ‰é’®
    [ ] åˆ é™¤æŒ‰é’®
    [ ] ä¸‹è½½æŒ‰é’®

[ ] 2.2 Video Node
    [ ] è§†é¢‘é¢„è§ˆç»„ä»¶
    [ ] æ‚¬åœæ’­æ”¾
    [ ] è§†é¢‘ç”Ÿæˆè§¦å‘
    [ ] Hailuo 2.3 é€‚é…å™¨

[ ] 2.3 å³é”®èœå•
    [ ] ç”»å¸ƒç©ºç™½å¤„å³é”®
    [ ] èŠ‚ç‚¹å³é”®
    [ ] ä¸Šä¼ /æ·»åŠ èŠ‚ç‚¹é€‰é¡¹

[ ] 2.4 è¿é•œæŒ‡ä»¤é¢æ¿
    [ ] æ¨æ‹‰ç±»æŒ‰é’® (Zoom In/Out)
    [ ] æ‘‡æ‘„ç±»æŒ‰é’® (Pan/Tilt)
    [ ] ç§»æ‘„ç±»æŒ‰é’® (Dolly/Truck)
```

### ğŸŸ¡ Phase 3: é«˜çº§åŠŸèƒ½ (P2) - é¢„è®¡ 2-3 å¤©

```
[ ] 3.1 é­”æ³•æ£’ Prompt å¢å¼º
    [ ] æ¥å…¥ GPT API
    [ ] ä¼˜åŒ–æç¤ºè¯

[ ] 3.2 é«˜çº§å‚æ•°é¢æ¿
    [ ] Seed æ§åˆ¶
    [ ] Steps æ§åˆ¶
    [ ] CFG æ§åˆ¶
    [ ] æ‰¹æ¬¡æ•°é‡

[ ] 3.3 å¿«æ·é”®ç³»ç»Ÿ
    [ ] Cmd+Z æ’¤é”€
    [ ] Shift+Cmd+Z é‡åš
    [ ] Cmd+V ç²˜è´´
    [ ] Delete åˆ é™¤èŠ‚ç‚¹

[ ] 3.4 èŠ‚ç‚¹è¯¦æƒ…é¢æ¿
    [ ] æŸ¥çœ‹ç”Ÿæˆå‚æ•°
    [ ] å¤åˆ¶å‚æ•°
    [ ] å…¨å±é¢„è§ˆ
```

### ğŸŸ¢ Phase 4: è§†è§‰ä¼˜åŒ– (P3) - é¢„è®¡ 1-2 å¤©

```
[ ] 4.1 è™šæ‹Ÿæ‘„å½±æœºé¢æ¿
    [ ] æœºå‹æ¨¡æ‹Ÿé€‰æ‹©å™¨
    [ ] é•œå¤´ç»„é€‰æ‹©å™¨
    [ ] ç„¦è·æ»‘å—
    [ ] å…‰åœˆæ»‘å—

[ ] 4.2 UI è§†è§‰ä¼˜åŒ–
    [ ] ç£¨ç ‚ç»ç’ƒå¼¹çª—
    [ ] è¿çº¿é«˜äº®æ•ˆæœ
    [ ] èŠ‚ç‚¹çŠ¶æ€åŠ¨ç”»
    [ ] Loading åŠ¨ç”»
```

---

## ğŸ“ æ•°æ®ç»“æ„

### èŠ‚ç‚¹æ•°æ®æ¨¡å‹

```typescript
interface NodeData {
  node_id: string;           // UUID
  parent_id: string | null;  // çˆ¶èŠ‚ç‚¹ ID
  type: 'image' | 'video' | 'text';
  content_url: string;       // S3/R2 URL
  generation_metadata: {
    prompt: string;
    base_model: 'banana-pro' | 'jimeng-4.5' | 'hailuo-2.3';
    ratio: '16:9' | '9:16' | '1:1' | '4:3';
    resolution: '1024x576' | '1024x1024' | '2048x2048';
    seed: number;
    camera_control?: {
      zoom?: 'in' | 'out';
      pan?: 'left' | 'right';
      tilt?: 'up' | 'down';
      movement?: 'dolly_in' | 'dolly_out' | 'truck_left' | 'truck_right';
      special?: 'follow' | 'shake' | 'static';
      amount?: number;  // 0-1
    };
  };
  canvas_position: { x: number; y: number };
  created_at: string;
}
```

### ç”Ÿæˆä»»åŠ¡æ¨¡å‹

```typescript
interface GenerationTask {
  task_id: string;
  node_id: string;
  status: 'queued' | 'processing' | 'succeeded' | 'failed';
  progress: number;  // 0-100
  params: {
    prompt: string;
    model: string;
    ratio: string;
    ref_image?: string;
    camera_control?: object;
  };
  result?: {
    url: string;
    seed: number;
    duration_ms: number;
  };
  error?: string;
}
```

---

## ğŸ”— API æ¥å£è®¾è®¡

### å›¾ç‰‡ç”Ÿæˆ

```
POST /api/generate/image
{
  "prompt": "ä¸€ä¸ªå¤é£å°‘å¥³ç«™åœ¨ç«¹æ—ä¸­",
  "model": "banana-pro",
  "ratio": "16:9",
  "ref_image": "https://...",  // å¯é€‰
  "seed": 12345,               // å¯é€‰
  "batch": 1                   // 1-4
}

Response:
{
  "task_id": "uuid",
  "status": "queued"
}
```

### è§†é¢‘ç”Ÿæˆ

```
POST /api/generate/video
{
  "prompt": "äººç‰©é£èº«å†²åˆ°ç«¹æ—ä¸Šç©º",
  "model": "hailuo-2.3",
  "source_image": "https://...",
  "duration": 6,  // 6s or 10s
  "camera_control": {
    "zoom": "in",
    "amount": 0.5
  }
}
```

### ä»»åŠ¡çŠ¶æ€æŸ¥è¯¢

```
GET /api/task/{task_id}

Response:
{
  "task_id": "uuid",
  "status": "processing",
  "progress": 45,
  "result": null
}
```

---

## ğŸ¨ UI è§„èŒƒ

### é¢œè‰²ç³»ç»Ÿ

```css
--bg-primary: #000000;      /* ä¸»èƒŒæ™¯ */
--bg-secondary: #121212;    /* æ¬¡çº§èƒŒæ™¯ */
--bg-panel: rgba(30, 30, 30, 0.9);  /* å¼¹çª—èƒŒæ™¯ */
--border-default: #333333;
--border-active: #FFFFFF;
--text-primary: #FFFFFF;
--text-secondary: #888888;
--accent-yellow: #FFD700;   /* ç”Ÿæˆä¸­ */
--accent-green: #00FF00;    /* æˆåŠŸ */
--accent-red: #FF4444;      /* å¤±è´¥ */
```

### è¿çº¿æ ·å¼

```css
/* é»˜è®¤è¿çº¿ */
stroke: #444444;
stroke-width: 2px;

/* é€‰ä¸­/é«˜äº®è¿çº¿ */
stroke: #FFFFFF;
stroke-width: 3px;
filter: drop-shadow(0 0 4px rgba(255,255,255,0.5));
```

---

## âœ… éªŒæ”¶æ ‡å‡†

### MVP éªŒæ”¶ âœ… å·²å®Œæˆ

- [x] ç”»å¸ƒæ”¯æŒæ— é™ç¼©æ”¾å’Œæ¼«æ¸¸
- [x] èŠ‚ç‚¹å¯ä»¥æ‹–æ‹½å’Œè¿çº¿
- [x] å¤šäººåä½œå…‰æ ‡åŒæ­¥
- [x] åŒå‡»èŠ‚ç‚¹å¯ä»¥å”¤èµ·ç”Ÿæˆå¼¹çª—
- [x] å¯ä»¥è¾“å…¥ Prompt å¹¶é€‰æ‹©æ¨¡å‹
- [x] ç‚¹å‡»ç”Ÿæˆåï¼ŒèŠ‚ç‚¹æ˜¾ç¤º Loading çŠ¶æ€å’Œè¿›åº¦æ¡
- [x] ç”Ÿæˆå®Œæˆåï¼Œå›¾ç‰‡æ˜¾ç¤ºåœ¨èŠ‚ç‚¹ä¸­ (Mock)

### Phase 1 éªŒæ”¶

- [ ] Banana Pro API æ­£å¸¸è°ƒç”¨
- [ ] å³æ¢¦ 4.5 API æ­£å¸¸è°ƒç”¨
- [ ] çœŸå®å›¾ç‰‡ç”Ÿæˆå¹¶æ˜¾ç¤ºåœ¨èŠ‚ç‚¹ä¸­
- [ ] é”™è¯¯å¤„ç†æ­£å¸¸

### Phase 2 éªŒæ”¶

- [ ] æ‚¬åœèŠ‚ç‚¹æ˜¾ç¤ºæ“ä½œèœå•
- [ ] å¯ä»¥åˆ é™¤èŠ‚ç‚¹å’Œè¿çº¿
- [ ] è§†é¢‘èŠ‚ç‚¹å¯ä»¥æ’­æ”¾
- [ ] å³é”®èœå•å¯ä»¥æ·»åŠ èŠ‚ç‚¹
- [ ] è¿é•œæŒ‡ä»¤å¯ä»¥é€‰æ‹©

### Phase 3 éªŒæ”¶

- [ ] é­”æ³•æ£’å¯ä»¥ä¼˜åŒ– Prompt
- [ ] å¿«æ·é”®æ­£å¸¸å·¥ä½œ
- [ ] å¯ä»¥æŸ¥çœ‹å’Œå¤åˆ¶ç”Ÿæˆå‚æ•°

### Phase 4 éªŒæ”¶

- [ ] è™šæ‹Ÿæ‘„å½±æœºå‚æ•°å¯é…ç½®
- [ ] UI åŠ¨ç”»æµç•…
- [ ] æ•´ä½“è§†è§‰ç¬¦åˆ Tapnow é£æ ¼

---

## ğŸ“ å½“å‰æ–‡ä»¶ç»“æ„

```
cineflow-mvp/src/
â”œâ”€â”€ types/
â”‚   â”œâ”€â”€ index.ts              âœ… èŠ‚ç‚¹ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ generation.ts         âœ… ç”Ÿæˆä»»åŠ¡ç±»å‹
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ adapters/
â”‚   â”‚   â””â”€â”€ mock-adapter.ts   âœ… Mock é€‚é…å™¨
â”‚   â”œâ”€â”€ store/
â”‚   â”‚   â””â”€â”€ generation-store.ts âœ… ç”ŸæˆçŠ¶æ€ç®¡ç†
â”‚   â””â”€â”€ collaboration/
â”‚       â”œâ”€â”€ yjs-provider.ts   âœ… Yjs åä½œ
â”‚       â”œâ”€â”€ sync-nodes.ts     âœ… èŠ‚ç‚¹åŒæ­¥
â”‚       â””â”€â”€ presence.ts       âœ… å…‰æ ‡åŒæ­¥
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ nodes/
â”‚   â”‚   â””â”€â”€ CardNode.tsx      âœ… å¡ç‰‡èŠ‚ç‚¹ (å«è¿›åº¦æ¡+å‘¼å¸ç¯)
â”‚   â”œâ”€â”€ canvas/
â”‚   â”‚   â”œâ”€â”€ FlowCanvas.tsx    âœ… ç”»å¸ƒ (å«åŒå‡»äº‹ä»¶)
â”‚   â”‚   â”œâ”€â”€ FloatingToolbar.tsx âœ… æ‚¬æµ®å·¥å…·æ 
â”‚   â”‚   â””â”€â”€ CursorOverlay.tsx âœ… å¤šäººå…‰æ ‡
â”‚   â””â”€â”€ panels/
â”‚       â””â”€â”€ GenerationPanel.tsx âœ… ç”Ÿæˆå¼¹çª—
â””â”€â”€ app/
    â””â”€â”€ canvas/
        â””â”€â”€ page.tsx          âœ… ç”»å¸ƒé¡µé¢
```

