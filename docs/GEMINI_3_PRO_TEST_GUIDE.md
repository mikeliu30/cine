# ğŸ§ª Gemini 3 Pro ä¿®å¤éªŒè¯æŒ‡å—

## âœ… ä¿®å¤å†…å®¹æ€»ç»“

### é—®é¢˜
- è°ƒç”¨ `gemini-3-pro-image-preview` æ—¶è¿”å› 404 é”™è¯¯
- åŸå› ï¼šä½¿ç”¨äº†é”™è¯¯çš„æ¨¡å‹å `gemini-2.5-flash-image`ï¼ˆå·²ä¸‹çº¿ï¼‰
- åŸå› ï¼šåŒºåŸŸç«¯ç‚¹ `us-central1` ä¸æ”¯æŒé¢„è§ˆç‰ˆæ¨¡å‹

### è§£å†³æ–¹æ¡ˆ
1. âœ… ä¿®æ”¹æ¨¡å‹åä¸º `gemini-3-pro-image-preview`
2. âœ… è‡ªåŠ¨åˆ‡æ¢åˆ°å…¨çƒç«¯ç‚¹ `https://aiplatform.googleapis.com`
3. âœ… ä½ç½®ä» `us-central1` æ”¹ä¸º `global`

## ğŸ§ª å¿«é€ŸéªŒè¯æ­¥éª¤

### æ­¥éª¤ 1: è¿è¡Œç«¯ç‚¹æµ‹è¯•

```bash
cd cineflow-mvp
node scripts/test-gemini-endpoint.js
```

**é¢„æœŸè¾“å‡º**:
```
âœ… æµ‹è¯• 1: gemini-3-pro-image-preview - é€šè¿‡
âœ… æµ‹è¯• 2: gemini-2.0-flash-exp - é€šè¿‡
âœ… æµ‹è¯• 3: some-model-preview - é€šè¿‡
```

### æ­¥éª¤ 2: å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
npm run dev
```

ç­‰å¾…çœ‹åˆ°ï¼š
```
âœ“ Ready in 3.2s
â—‹ Local: http://localhost:3000
```

### æ­¥éª¤ 3: æµ‹è¯•å›¾ç‰‡ç”Ÿæˆ

1. æ‰“å¼€æµè§ˆå™¨è®¿é—®: http://localhost:3000/canvas
2. å³é”®ç‚¹å‡»ç”»å¸ƒ â†’ "æ·»åŠ å›¾ç‰‡èŠ‚ç‚¹"
3. åŒå‡»å›¾ç‰‡èŠ‚ç‚¹æ‰“å¼€ç”Ÿæˆé¢æ¿
4. è¾“å…¥æç¤ºè¯ï¼š`ä¸€åªå¯çˆ±çš„æ©˜çŒ«åœ¨é˜³å…‰ä¸‹æ‰“ç›¹`
5. é€‰æ‹©æ¨¡å‹ï¼š`ğŸŒ Gemini 3 Pro (Vertex AI)`
6. ç‚¹å‡»"ç”Ÿæˆ"æŒ‰é’®

### æ­¥éª¤ 4: æ£€æŸ¥æ§åˆ¶å°æ—¥å¿—

**æ­£ç¡®çš„æ—¥å¿—åº”è¯¥æ˜¾ç¤º**:

```
[Vertex Gemini] Using enterprise Gemini for image generation
[Vertex Gemini] Project: fleet-blend-469520-n7
[Vertex Gemini] Model: gemini-3-pro-image-preview
[Vertex Gemini] Location: global (using global for preview model)
[Vertex Gemini] Endpoint: https://aiplatform.googleapis.com/v1/projects/fleet-blend-469520-n7/locations/global/publishers/google/models/gemini-3-pro-image-preview:generateContent
```

**å…³é”®æ£€æŸ¥ç‚¹**:
- âœ… Location æ˜¾ç¤ºä¸º `global`
- âœ… Endpoint ä½¿ç”¨ `https://aiplatform.googleapis.com` (ä¸æ˜¯ `us-central1-aiplatform`)
- âœ… Model æ˜¯ `gemini-3-pro-image-preview`

### æ­¥éª¤ 5: éªŒè¯ç»“æœ

**æˆåŠŸæ ‡å¿—**:
- âœ… èŠ‚ç‚¹çŠ¶æ€å˜ä¸º"ç”Ÿæˆä¸­"ï¼ˆé»„è‰²è¾¹æ¡†ï¼‰
- âœ… 10-30ç§’åæ˜¾ç¤ºç”Ÿæˆçš„å›¾ç‰‡
- âœ… å›¾ç‰‡æ¸…æ™°ï¼Œç¬¦åˆæç¤ºè¯æè¿°
- âœ… æ§åˆ¶å°æ—  404 é”™è¯¯

**å¦‚æœå¤±è´¥**:
- âŒ 404 é”™è¯¯ â†’ æ£€æŸ¥æ¨¡å‹åå’Œç«¯ç‚¹é…ç½®
- âŒ 401/403 é”™è¯¯ â†’ æ£€æŸ¥ vertex-key.json æƒé™
- âŒ è¶…æ—¶ â†’ æ£€æŸ¥ç½‘ç»œè¿æ¥

## ğŸ“Š ç«¯ç‚¹å¯¹æ¯”è¡¨

| é…ç½®é¡¹ | ä¿®å¤å‰ (âŒ é”™è¯¯) | ä¿®å¤å (âœ… æ­£ç¡®) |
|--------|----------------|----------------|
| æ¨¡å‹å | `gemini-2.5-flash-image` | `gemini-3-pro-image-preview` |
| ä½ç½® | `us-central1` | `global` |
| åŸºç¡€ URL | `https://us-central1-aiplatform.googleapis.com` | `https://aiplatform.googleapis.com` |
| å®Œæ•´ç«¯ç‚¹ | `.../us-central1/.../gemini-2.5-flash-image:...` | `.../global/.../gemini-3-pro-image-preview:...` |

## ğŸ¯ æµ‹è¯•ç”¨ä¾‹

### æµ‹è¯•ç”¨ä¾‹ 1: ç®€å•åœºæ™¯
- **æç¤ºè¯**: `ä¸€åªå¯çˆ±çš„å°çŒ«`
- **é¢„æœŸ**: ç”Ÿæˆä¸€å¼ å°çŒ«å›¾ç‰‡
- **æ—¶é—´**: 10-20ç§’

### æµ‹è¯•ç”¨ä¾‹ 2: å¤æ‚åœºæ™¯
- **æç¤ºè¯**: `ä¸€ä¸ªæœªæ¥ä¸»ä¹‰çš„åŸå¸‚ï¼Œéœ“è™¹ç¯é—ªçƒï¼Œèµ›åšæœ‹å…‹é£æ ¼ï¼Œé«˜æ¸…ï¼Œç”µå½±çº§ç”»è´¨`
- **é¢„æœŸ**: ç”Ÿæˆé«˜è´¨é‡çš„èµ›åšæœ‹å…‹åŸå¸‚å›¾ç‰‡
- **æ—¶é—´**: 20-30ç§’

### æµ‹è¯•ç”¨ä¾‹ 3: ä¸­æ–‡æç¤ºè¯
- **æç¤ºè¯**: `æ˜¥å¤©çš„æ¨±èŠ±æ ‘ä¸‹ï¼Œä¸€ä¸ªç©¿ç€å’Œæœçš„å¥³å­©åœ¨èµèŠ±`
- **é¢„æœŸ**: è‡ªåŠ¨ç¿»è¯‘å¹¶ç”Ÿæˆç›¸åº”å›¾ç‰‡
- **æ—¶é—´**: 15-25ç§’

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: ä»ç„¶å‡ºç° 404 é”™è¯¯

**æ£€æŸ¥æ¸…å•**:
1. ç¡®è®¤ä»£ç å·²ä¿å­˜å¹¶é‡å¯æœåŠ¡å™¨
2. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ (Ctrl+Shift+R)
3. æ£€æŸ¥ `route.ts` ç¬¬ 390 è¡Œæ˜¯å¦ä¸º `gemini-3-pro-image-preview`
4. æ£€æŸ¥æ§åˆ¶å°æ—¥å¿—ä¸­çš„ Location æ˜¯å¦ä¸º `global`

### é—®é¢˜ 2: 401 è®¤è¯é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥è®¤è¯æ–‡ä»¶
ls vertex-key.json

# æ£€æŸ¥ç¯å¢ƒå˜é‡
cat .env.local | grep GOOGLE
```

### é—®é¢˜ 3: ç”Ÿæˆé€Ÿåº¦æ…¢

**æ­£å¸¸æƒ…å†µ**:
- Gemini 3 Pro é¢„è§ˆç‰ˆé€šå¸¸éœ€è¦ 15-30 ç§’
- è¿™æ˜¯æ­£å¸¸çš„ï¼Œå› ä¸ºæ¨¡å‹åœ¨ç”Ÿæˆé«˜è´¨é‡å›¾ç‰‡

## ğŸ“ ä¿®æ”¹æ–‡ä»¶æ¸…å•

- âœ… `src/app/api/generate/image/route.ts` (ç¬¬ 390ã€403 è¡Œ)
- âœ… `docs/GEMINI_3_PRO_FIX.md` (æ–°å¢)
- âœ… `scripts/test-gemini-endpoint.js` (æ–°å¢)

## ğŸ‰ å®Œæˆæ ‡å¿—

å½“ä½ çœ‹åˆ°ä»¥ä¸‹æ‰€æœ‰å†…å®¹æ—¶ï¼Œè¯´æ˜ä¿®å¤æˆåŠŸï¼š

1. âœ… ç«¯ç‚¹æµ‹è¯•è„šæœ¬å…¨éƒ¨é€šè¿‡
2. âœ… æ§åˆ¶å°æ˜¾ç¤º `Location: global`
3. âœ… å›¾ç‰‡æˆåŠŸç”Ÿæˆå¹¶æ˜¾ç¤º
4. âœ… æ— ä»»ä½• 404 é”™è¯¯

## ğŸš€ ä¸‹ä¸€æ­¥

ä¿®å¤éªŒè¯æˆåŠŸåï¼Œä½ å¯ä»¥ï¼š

1. æµ‹è¯•ä¸åŒçš„æç¤ºè¯å’Œé£æ ¼
2. å°è¯•ç”Ÿæˆé«˜åˆ†è¾¨ç‡å›¾ç‰‡ï¼ˆæœ€é«˜ 4Kï¼‰
3. æ¢ç´¢ Gemini 3 Pro çš„å¤šè½®å¯¹è¯èƒ½åŠ›
4. é›†æˆåˆ°ä½ çš„å·¥ä½œæµä¸­

---

**éœ€è¦å¸®åŠ©ï¼Ÿ** æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—æˆ–è”ç³»æŠ€æœ¯æ”¯æŒã€‚

